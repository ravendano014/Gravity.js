function init(){var t=document.getElementById("canvas"),e=document.getElementById("controlbox");t.width=window.innerWidth-30,t.height=window.innerHeight-20,width=t.width,height=t.height,context=t.getContext("2d"),window.addEventListener("mousedown",mouseDownListener,!1),e.onmouseover=function(){onControlBox=!0},e.onmouseout=function(){onControlBox=!1}}function main(){starttime=Date.now(),integrate(),draw(),frametime=Date.now()-starttime}function mouseDownListener(t){onControlBox||(shiftDown=t.shiftKey,startCoords[0]=t.clientX,startCoords[1]=t.clientY,endCoords[0]=t.clientX,endCoords[1]=t.clientY,window.addEventListener("mousemove",mouseMoveListener,!1),window.addEventListener("mouseup",mouseUpListener,!1))}function mouseMoveListener(t){endCoords[0]=t.clientX,endCoords[1]=t.clientY}function mouseUpListener(t){window.removeEventListener("mousemove",mouseMoveListener),window.removeEventListener("mouseup",mouseUpListener),!t.shiftKey&&!shiftDown&&particleList.push(new Particle(newMass,startCoords[0],startCoords[1],endCoords[0]-startCoords[0],endCoords[1]-startCoords[1],currentParticleType)),t.shiftKey&&shiftDown&&(particleShift=[endCoords[0]-startCoords[0],endCoords[1]-startCoords[1]]),startCoords=[-1,-1],endCoords=[-1,-1]}function setNewMass(t){newMass=t}function toggleTrails(){trailsEnabled=!trailsEnabled}function toggleParticleType(){currentParticleType=currentParticleType=="matter"?"antimatter":"matter",document.getElementById("particleTypeBtn").innerHTML=currentParticleType=="matter"?"Matter":"Antimatter"}function integrate(){for(var t=0;t<particleList.length;t++){var e=particleList[t];e.ax=0,e.ay=0;for(var o=0;o<particleList.length;o++){if(t!==o){var r=particleList[o],i=r.x-e.x,s=r.y-e.y,a=Math.sqrt(i*i+s*s);if(a>1e-5){var n=e.type==r.type?1:-1;e.ax+=n*r.mass*i/(a*a*a),e.ay+=n*r.mass*s/(a*a*a)}}}}for(var c=[],l=0;l<particleList.length;l++){var d=particleList[l];d.vx+=d.ax*h,d.vy+=d.ay*h,d.x+=d.vx*h+particleShift[0],d.y+=d.vy*h+particleShift[1]}for(var p=new Array(particleList.length).fill(!1),u=0;u<particleList.length;u++){if(!p[u]){var m=particleList[u];for(var f=u+1;f<particleList.length;f++){if(!p[f]){var g=particleList[f],v=g.x-m.x,y=g.y-m.y,b=Math.sqrt(v*v+y*y);if(b<m.radius/1.5+g.radius/1.5){p[u]=!0,p[f]=!0;var w=m.mass+g.mass,x=(m.x*m.mass+g.x*g.mass)/w,P=(m.y*m.mass+g.y*g.mass)/w,C=(m.vx*m.mass+g.vx*g.mass)/w,A=(m.vy*m.mass+g.vy*g.mass)/w;c.push(new Particle(w,x,P,C,A,m.type==g.type?m.type:"matter"));break}}}}}for(var S=[],k=0;k<particleList.length;k++)!p[k]&&particleList[k].x>=-50&&particleList[k].y>=-50&&particleList[k].x<=width+50&&particleList[k].y<=height+50&&S.push(particleList[k]);particleList=S.concat(c),particleShift=[0,0]}function draw(){trailsEnabled?(context.fillStyle="rgba(0,0,0,0.05)",context.fillRect(0,0,width,height)):context.clearRect(0,0,width,height),context.beginPath(),context.moveTo(startCoords[0],startCoords[1]),context.lineTo(endCoords[0],endCoords[1]),context.strokeStyle="blue",context.strokeWidth=2,context.stroke();for(var t=0;t<particleList.length;t++){var e=particleList[t],o=context.createRadialGradient(e.x,e.y,.75*e.radius,e.x,e.y,e.radius);o.addColorStop(0,"rgba("+e.color[0]+","+e.color[1]+","+e.color[2]+",1.0)"),o.addColorStop(1,"rgba("+e.color[0]+","+e.color[1]+","+e.color[2]+",0)"),context.beginPath(),context.arc(e.x,e.y,e.radius,0,2*Math.PI),context.closePath(),context.fillStyle=e.radius<3?"#"+e.color[3]:o,context.fill()}}var h=.005,context,particleList=[],frametime,starttime,width,height,startCoords=[-1,-1],endCoords=[-1,-1],newMass=1e3,onControlBox=!1,shiftDown=!1,particleShift=[0,0],trailsEnabled=!1,currentParticleType="matter";
